<app-header [titleHeader]="'DBS - Early Infant Diagnosis'" [isMenuOrBackButton]="'back'"></app-header>


<ion-content>
  <p *ngIf="viewAccessMessage">{{viewAccessMessage}}</p>
  <mat-accordion class="example-headers-align">
    <mat-expansion-panel *ngIf="showParticipantData" [expanded]="step === 0" (opened)="setStep(0)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Participant Details
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-grid>
        <ion-row *ngIf="participantData.participantName">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Participant Name </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{participantData.participantName}}</span>
            </p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="participantData.participantCode">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Participant Code </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{participantData.participantCode}}</span>
            </p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="participantData.affiliation">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Affiliation </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{participantData.affiliation}}</span>
            </p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="participantData.phone">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Phone No </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{participantData.phone}}</span>
            </p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="participantData.mobile">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Mobile No</span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span> {{participantData.mobile}}</span>
            </p>
          </ion-col>
        </ion-row>
      </ion-grid>
      <mat-action-row>
        <button mat-button color="primary" (click)="nextStep()">Next</button>
      </mat-action-row>
    </mat-expansion-panel>

    <mat-expansion-panel *ngIf="showShipmentData" [expanded]="step === 1" (opened)="setStep(1)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Shipment Details
        </mat-panel-title>

      </mat-expansion-panel-header>

      <ion-grid>
        <ion-row *ngIf="shipmentData.shipmentDate">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Shipment Date </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{shipmentData.shipmentDate}}</span>
            </p>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="shipmentData.resultDueDate">
          <ion-col size="5" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">Result Due Date </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p text-wrap>
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p text-wrap>
              <span>{{shipmentData.resultDueDate}} 
              </span>
            </p>
          </ion-col>
        </ion-row>
      </ion-grid>
      <ion-grid>
        <ion-row>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Shipment Receipt Date</mat-label>
              <input matInput [matDatepicker]="testReceiptPicker" class="datepicker-input"[(ngModel)]="shipmentData.testReceiptDate"
                placeholder="Choose Test Receipt date" required >
              <mat-datepicker-toggle matSuffix [for]="testReceiptPicker"></mat-datepicker-toggle>
              <mat-datepicker #testReceiptPicker disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.testReceiptDate">Please Choose Test Receipt Date. Eg: 28-Feb-2020</mat-error>


            </mat-form-field>
          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Sample Rehydration Date</mat-label>
              <input matInput [matDatepicker]="sampleRhdPicker" [(ngModel)]="shipmentData.sampleRehydrationDate" placeholder="Choose a date"
                required>
              <mat-datepicker-toggle matSuffix [for]="sampleRhdPicker"></mat-datepicker-toggle>
              <mat-datepicker #sampleRhdPicker disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.sampleRehydrationDate">Please Choose Test Sample Rehydration Date.</mat-error>
              <!-- <mat-error *ngIf="!sampleRhdDate" style="margin-bottom:10px">Eg: 28-Feb-2020</mat-error> -->

            </mat-form-field>
          </ion-col>

          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Shipment Testing Date</mat-label>
              <input matInput [matDatepicker]="testDatePicker" [(ngModel)]="shipmentData.shipmentTestingDate" placeholder="Choose a date"
                required >
              <mat-datepicker-toggle matSuffix [for]="testDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #testDatePicker disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.shipmentTestingDate">Please Choose Testing Date. Eg: 28-Feb-2020</mat-error>

            </mat-form-field>
          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Extraction Assay </mat-label>
              <mat-select [(ngModel)]="shipmentData.extractionAssay" name="extractionAssay" >
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let vl of shipmentData.extractionAssayDropdown" [value]="vl.value">
                  {{vl.show}}
                </mat-option>
              </mat-select>

              <mat-error *ngIf="!shipmentData.extractionAssay">Please choose Extraction Assay </mat-error>
            </mat-form-field>

          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Detection Assay </mat-label>
              <mat-select [(ngModel)]="shipmentData.detectionAssay" name="detAssay" >
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let vl of shipmentData.detectionAssayDropdown" [value]="vl.value">
                  {{vl.show}}
                </mat-option>
              </mat-select>

              <mat-error *ngIf="!shipmentData.detectionAssay">Please choose Detection Assay </mat-error>
            </mat-form-field>

          </ion-col>
        
        </ion-row>
       
        <ion-row>
          
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Extraction Assay Lot No.</mat-label>
              <input matInput [(ngModel)]="shipmentData.extractionLotNumber" placeholder="Enter Extraction Assay Lot No.">
            </mat-form-field>
          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Detection Assay Lot No.</mat-label>
              <input matInput [(ngModel)]="shipmentData.detectionLotNumber" placeholder="Enter Detection Assay Lot No.">
            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Extraction Assay Expiration Date</mat-label>
              <input matInput [matDatepicker]="extAssayExpiryDate" [(ngModel)]="shipmentData.extractionExpirationDate" placeholder="Choose a date"
                required >
              <mat-datepicker-toggle matSuffix [for]="extAssayExpiryDate"></mat-datepicker-toggle>
              <mat-datepicker #extAssayExpiryDate disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.extractionExpirationDate">Please Choose Expiration Date. Eg: 28-Feb-2020</mat-error>

            </mat-form-field>
          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Detection Assay Expiration Date</mat-label>
              <input matInput [matDatepicker]="detAssayExpiryDate" [(ngModel)]="shipmentData.detectionExpirationDate" placeholder="Choose a date"
                required >
              <mat-datepicker-toggle matSuffix [for]="detAssayExpiryDate"></mat-datepicker-toggle>
              <mat-datepicker #detAssayExpiryDate disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.detectionExpirationDate">Please Choose Expiration Date. Eg: 28-Feb-2020</mat-error>

            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Response Date</mat-label>
              <input matInput [matDatepicker]="respDate" placeholder="Choose a date" [(ngModel)]="shipmentData.responseDate" required>
              <mat-datepicker-toggle matSuffix [for]="respDate"></mat-datepicker-toggle>
              <mat-datepicker #respDate disabled="false"></mat-datepicker>
              <mat-error *ngIf="!shipmentData.responseDate">Please Choose Response Date. Eg: 28-Feb-2020</mat-error>
            </mat-form-field>
          </ion-col>
          <ion-col size="6" size-xs class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Mode of Receipt</mat-label>
              <mat-select [(ngModel)]="shipmentData.modeOfReceipt" name="receiptmode" required>
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let item of shipmentData.modeOfReceiptDropdown" [value]="item.value">
                  {{item.show}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="!receiptmode">Please choose the Mode Of Receipt </mat-error>
            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="isQCDoneShow">
          <ion-col size="12">
            <mat-label style="margin-left: 10px;">QC Done</mat-label>
            <mat-radio-group aria-labelledby="example-radio-group-label" class="login-full-width grid-col-form"
              [(ngModel)]="qcDone">
              <mat-radio-button class="example-radio-button" *ngFor="let qcData of qcRadioArray" [value]="qcData.value">
                {{qcData.show}}
              </mat-radio-button>
            </mat-radio-group>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="isQCDoneShow && qcDone=='yes'">
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>QC Date</mat-label>
              <input matInput [matDatepicker]="qcDatePicker" [(ngModel)]="qcDate" placeholder="Choose a date" 
              [required]="isQCDoneShow && qcDone=='yes'">
              <mat-datepicker-toggle matSuffix [for]="qcDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #qcDatePicker disabled="false"></mat-datepicker>
            </mat-form-field>
          </ion-col>
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>QC Done By </mat-label>
              <input matInput [(ngModel)]="qcDoneBy" placeholder="Enter QC Done by">
            </mat-form-field>
          </ion-col>
        </ion-row>
      </ion-grid>

      <mat-action-row>
        <button mat-button color="primary" (click)="prevStep()">Previous</button>
        <button mat-button color="warn" (click)="nextStep()">Next</button>
      </mat-action-row>
    </mat-expansion-panel>

    <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          PT Panel Test
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ion-row>
        <ion-col class="grid-input-col">
          <section class="div-section">
            <mat-checkbox [(ngModel)]="ptPanelNotTested">PT panel not tested</mat-checkbox>
          </section>
        </ion-col>
      </ion-row>
      <section *ngIf="ptPanelNotTested==false || !ptPanelNotTested">
       
 
        <div *ngIf="ptPanelData.sampleTextData">

          <mat-card class="dynamic-card" *ngFor="let sampleName of ptPanelData.sampleTextData.label ;let i = index">
            <mat-card-title>
            {{sampleName}}
              <span class="danger-text" *ngIf="ptPanelData.sampleTextData.mandatory[i]==true">*</span>
            </mat-card-title>
            <mat-card-content>
           
                <!-- <div *ngFor="let check of ptPanelTestArray.vlResult;let k = index"> -->
                  <ion-row>
                  <ion-col  class="grid-input-col">
                    <p class="no-padding" style="margin-top: 0;" *ngIf="ptPanelData.resultsTextData[0]">
                      {{ptPanelData.resultsTextData[0]}}
                    </p>
                    <mat-form-field class="login-full-width " appearance="outline" *ngIf="ptPanelData.samplesList">
                      <mat-label>{{ptPanelData.resultsTextData[1]}}</mat-label>
                      <mat-select [(ngModel)]="ptPanelData.sampleData[sampleName]['Your-Results']"
                       name="yourResults" [required]="ptPanelData.sampleTextData.mandatory[i]==true">
                        <mat-option>--Select--</mat-option>
                        <mat-option *ngFor="let item of ptPanelData.samplesList[sampleName]['Your-Results']" [value]="item.value">
                          {{item.show}}
                        </mat-option>
                      </mat-select>                      
                     <mat-error *ngIf="ptPanelData.sampleTextData.mandatory[i]==true && !ptPanelData.sampleData[sampleName]['Your-Results']">Please Enter {{ptPanelData.resultsTextData[1]}}</mat-error>

                    </mat-form-field>
                  </ion-col>
                </ion-row>
                <!-- </div> -->
              
            
                <!-- <div *ngFor="let item of ptPanelTestArray.tndReferenceRadio;let j= index"> -->
                  <ion-row>
                  <ion-col  class="grid-input-col">
         
                    <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                      <mat-label>{{ptPanelData.resultsTextData[2]}}</mat-label>
                      <input matInput [(ngModel)]="ptPanelData.sampleData[sampleName]['HIV-CT/OD']"
                       placeholder="Enter HIV CT/OD" [required]="ptPanelData.sampleTextData.mandatory[i]==true">
                       <mat-error *ngIf="ptPanelData.sampleTextData.mandatory[i]==true && !ptPanelData.sampleData[sampleName]['HIV-CT/OD']">Please Enter {{ptPanelData.resultsTextData[2]}}</mat-error>
                 
                      </mat-form-field>
                  </ion-col>            

              </ion-row>
              <ion-row>
                <ion-col  class="grid-input-col">
       
                  <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                    <mat-label>{{ptPanelData.resultsTextData[3]}}</mat-label>
                    <input matInput [(ngModel)]="ptPanelData.sampleData[sampleName]['IC/QS-Values']" 
                    placeholder="Enter IC/QS Values" [required]="ptPanelData.sampleTextData.mandatory[i]==true">
                    <mat-error *ngIf="ptPanelData.sampleTextData.mandatory[i]==true && !ptPanelData.sampleData[sampleName]['IC/QS-Values']">Please Enter {{ptPanelData.resultsTextData[3]}}</mat-error>
                 
                  </mat-form-field>
                </ion-col>            

            </ion-row>
            <!-- </div> -->
            </mat-card-content>
          </mat-card>

        </div>
      </section>
      <section *ngIf="ptPanelNotTested">
        <ion-row>
          <ion-col size="12" class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>
                {{ptPanelData.vlNotTestedReasonText}} 
              </mat-label>
              <mat-select [(ngModel)]="ptPanelData.vlNotTestedReason" name="vlNotTested" 
              [required]="ptPanelNotTested">
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let item of ptPanelData.vlNotTestedReasonDropdown" [value]="item.value">
                  {{item.show}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="ptPanelNotTested && !vlNotTestedReason">Please choose the Reason for not testing</mat-error>
            </mat-form-field>
          </ion-col>
          <ion-col size="12" class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>
                {{ptPanelData.ptNotTestedCommentsText}}
              </mat-label>
              <textarea matInput placeholder="Enter Your Comments here" [(ngModel)]="ptPanelData.ptNotTestedComments"
              [required]="ptPanelNotTested"></textarea>
              <mat-error *ngIf="ptPanelNotTested && !ptPanelData.ptNotTestedComments">Please Enter Your Comments</mat-error>
            </mat-form-field>
          </ion-col>
          <ion-col size="12" class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>
                {{ptPanelData.ptSupportCommentsText}}

              </mat-label>
              <textarea matInput placeholder="Enter Your Support Comments here" [(ngModel)]="ptPanelData.ptSupportComments"
              [required]="ptPanelNotTested"></textarea>
              <mat-error *ngIf="ptPanelNotTested && !ptPanelData.ptSupportComments">Please Enter Your Comments</mat-error>
            </mat-form-field>
          </ion-col>
        </ion-row>
      </section>
      <mat-action-row>
        <button mat-button color="warn" (click)="prevStep()">Previous</button>
        <button mat-button color="primary" (click)="nextStep()">Next</button>
      </mat-action-row>
    </mat-expansion-panel>

    <mat-expansion-panel *ngIf="showOtherInfoData" [expanded]="step === 3" (opened)="setStep(3)">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Other Informations
        </mat-panel-title>

      </mat-expansion-panel-header>

      <ion-grid>
        <ion-row>
          <ion-col class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Supervisor Review </mat-label>
              <mat-select [(ngModel)]="otherInfoData.supervisorReview" name="supervisorReview">
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let sr of otherInfoData.supervisorReviewDropdown" [value]="sr.value">
                  {{sr.show}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </ion-col>
          <ion-col *ngIf="otherInfoData.supervisorReview=='yes'" class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>{{otherInfoData.supervisorLabel}} </mat-label>
              <input matInput [(ngModel)]="otherInfoData.supervisorName" placeholder="Enter Supervisor Name">
            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col class="grid-input-col">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Comments</mat-label>
              <textarea matInput placeholder="Enter Comments here" [(ngModel)]="otherInfoData.comments"></textarea>
            </mat-form-field>
          </ion-col>
        </ion-row>

      </ion-grid>

      <mat-action-row>
        <button mat-button color="primary" (click)="prevStep()">Previous</button>
        <button mat-button color="warn" (click)="submitViralLoad()">Submit</button>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>


</ion-content>