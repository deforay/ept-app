<app-header [titleHeader]="'DTS - HIV Serology'" [isMenuOrBackButton]="'back'"></app-header>

<ion-content>
  <mat-accordion>
    <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)">
      <mat-expansion-panel-header class="formMatExpPanel" >
        <mat-panel-title>
          <ion-grid class="panelHeading">
            <ion-row>
              <ion-col size="12" class="grid-readonly-col">
                <span class="text-title-color">Participant Details</span>
              </ion-col>
            </ion-row>
          </ion-grid>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ion-grid>

        <ion-row *ngIf="partiDetailsArray.participantName">
          <ion-col size="6" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">Participant Name</span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p class="ion-text-wrap" class="partiValues">
              <span>{{partiDetailsArray.participantName}}</span>
            </p>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="partiDetailsArray.participantCode">
          <ion-col size="6" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">Participant Code </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p class="ion-text-wrap" class="partiValues">
              <span>{{partiDetailsArray.participantCode}}</span>
            </p>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="partiDetailsArray.affiliation">
          <ion-col size="6" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">Affiliation </span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p class="ion-text-wrap" class="partiValues">
              <span>{{partiDetailsArray.affiliation}}</span>
            </p>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="partiDetailsArray.phone">
          <ion-col size="6" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">Tel Phone No</span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p class="ion-text-wrap" class="partiValues">
              <span>{{partiDetailsArray.phone}}</span>
            </p>
          </ion-col>
        </ion-row>


        <ion-row *ngIf="partiDetailsArray.mobile">
          <ion-col size="6" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">Mobile No</span>
            </p>
          </ion-col>
          <ion-col size="1" class="grid-readonly-col">
            <p class="ion-text-wrap">
              <span class="text-title-color">:</span>
            </p>
          </ion-col>
          <ion-col class="grid-readonly-col">
            <p class="ion-text-wrap" class="partiValues">
              <span>{{partiDetailsArray.mobile}}</span>
            </p>
          </ion-col>
        </ion-row>

      </ion-grid>
      <mat-action-row>
        <button mat-button color="primary" (click)="nextStep()">Next</button>
      </mat-action-row>
    </mat-expansion-panel>
    <!-- (opened)="panelOpenState = true"
                         (closed)="panelOpenState = false"  -->

    <form #shipmentPanelForm="ngForm" novalidate>
      <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)">
        <mat-expansion-panel-header class="formMatExpPanel">
          <mat-panel-title>
            <ion-grid class="panelHeading">
              <ion-row>
                <ion-col size="10" class="grid-readonly-col">
                  <span class="text-title-color">Shipment Details</span>
                </ion-col>
                <ion-col size="2" class="grid-readonly-col" *ngIf="isValidShipmentDetails==true">
                  <ion-icon name="checkmark-circle" class="checkMarkIcon"></ion-icon>
                </ion-col>
              </ion-row>
            </ion-grid>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <ion-grid>
          <ion-row *ngIf="shipmentsDetailsArray.shipmentDate">
            <ion-col size="5">
              <p class="ion-text-wrap">
                <span class="text-title-color">Shipment Date </span>
              </p>
            </ion-col>
            <ion-col size="1">
              <p class="ion-text-wrap">
                <span class="text-title-color">:</span>
              </p>
            </ion-col>
            <ion-col>
              <p class="ion-text-wrap">
                <span>{{shipmentsDetailsArray.shipmentDate}} </span>
              </p>
            </ion-col>
          </ion-row>
          <ion-row *ngIf="shipmentsDetailsArray.resultDueDate">
            <ion-col size="5">
              <p class="ion-text-wrap">
                <span class="text-title-color">Result Due Date </span>
              </p>
            </ion-col>
            <ion-col size="1">
              <p class="ion-text-wrap">
                <span class="text-title-color">:</span>
              </p>
            </ion-col>
            <ion-col>
              <p class="ion-text-wrap">
                <span>{{shipmentsDetailsArray.resultDueDate}}
                </span>
              </p>
            </ion-col>
          </ion-row>
        </ion-grid>
        <ion-grid>

          <ion-row>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Test Receipt Date</mat-label>
                <input matInput [matDatepicker]="testReceiptPicker" [(ngModel)]="testReceiptDate"
                  placeholder="Choose a date" required disabled="false" name="seroTestReceiptDate"
                  #seroTestReceiptDate="ngModel">
                <mat-datepicker-toggle matSuffix [for]="testReceiptPicker"></mat-datepicker-toggle>
                <mat-datepicker #testReceiptPicker disabled="false"></mat-datepicker>
                <mat-error *ngIf="!testReceiptDate">
                  Test Receipt Date is required</mat-error>
              </mat-form-field>
            </ion-col>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Sample Rehydration Date</mat-label>
                <input matInput [matDatepicker]="sampleRhdPicker" name="seroSampleRhdDate" #seroSampleRhdDate="ngModel"
                  [(ngModel)]="sampleRhdDate" placeholder="Choose a date" required disabled="false">
                <mat-datepicker-toggle matSuffix [for]="sampleRhdPicker"></mat-datepicker-toggle>
                <mat-datepicker #sampleRhdPicker disabled="false"></mat-datepicker>
                <mat-error *ngIf="!sampleRhdDate">
                  Sample Rehydration Date is required</mat-error>
              </mat-form-field>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Testing Date</mat-label>
                <input matInput [matDatepicker]="testDatePicker" [(ngModel)]="testingDate" name="seroTestingDate"
                  #seroTestingDate="ngModel" placeholder="Choose a date" required disabled="false">
                <mat-datepicker-toggle matSuffix [for]="testDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #testDatePicker disabled="false"></mat-datepicker>
                <mat-error *ngIf="!testingDate">
                  Testing Date is required</mat-error>
              </mat-form-field>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Response Date</mat-label>
                <input matInput [matDatepicker]="respDatePicker" [(ngModel)]="respDate" name="seroRespDate"
                  placeholder="Choose a date" #seroRespDate="ngModel" required disabled="false">
                <mat-datepicker-toggle matSuffix [for]="respDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #respDatePicker disabled="false"></mat-datepicker>
                <mat-error *ngIf="!respDate">
                  Response Date is required</mat-error>
              </mat-form-field>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Algorithm Used </mat-label>
                <mat-select [(ngModel)]="algorithmused" name="alg" #alg="ngModel" required>
                  <mat-option>--Select--</mat-option>
                  <mat-option *ngFor="let alg of algorithmUsedSelectArray" [value]="alg.value">
                    {{alg.show}}
                  </mat-option>
                </mat-select>

                <mat-error *ngIf="!algorithmused">Please choose the Algorithm Used </mat-error>
              </mat-form-field>
            </ion-col>
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>Mode of Receipt</mat-label>
                <mat-select [(ngModel)]="receiptmode" name="rmode" #rmode="ngModel" required>
                  <mat-option>--Select--</mat-option>
                  <mat-option *ngFor="let modeRec of modeOfReceiptArray" [value]="modeRec.value">
                    {{modeRec.show}}
                  </mat-option>
                </mat-select>

                <mat-error *ngIf="!receiptmode">Please choose the Mode Of Receipt </mat-error>
              </mat-form-field>
            </ion-col>
          </ion-row>

          <!-- <ion-row *ngIf="isQCDoneShow">
          <ion-col size="12">
              <mat-label>QC Done</mat-label> 
             <mat-radio-group
              aria-labelledby="example-radio-group-label"
              class="login-full-width grid-col-form"
              [(ngModel)]="qcDone">
              <mat-radio-button class="example-radio-button" *ngFor="let qcData of qcRadioArray" [value]="qcData.value">
                {{qcData.show}}
              </mat-radio-button>
            </mat-radio-group> 
          </ion-col>
        </ion-row> -->
          <ion-row *ngIf="isQCDoneShow">
            <ion-col size="12">
              <mat-label class="matLabel" style="margin-left: 5px;font-size: 13px;">QC Done</mat-label>
              <mat-radio-group aria-labelledby="example-radio-group-label" class="login-full-width grid-col-form"
                [(ngModel)]="qcDone" name="vlQcDone" #vlQcDone="ngModel" required>
                <mat-radio-button class="example-radio-button" *ngFor="let qcData of qcRadioArray"
                  [value]="qcData.value">
                  {{qcData.show}}
                </mat-radio-button>
              </mat-radio-group>
              <mat-error *ngIf="!qcDone">QC Done is required</mat-error>
            </ion-col>
          </ion-row>

          <ion-row *ngIf="isQCDoneShow && qcDone=='yes'">
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>QC Date</mat-label>
                <input matInput [matDatepicker]="qcDatePicker" [(ngModel)]="qcDate" name="seroqcDate" #seroqcDate="ngModel" placeholder="Choose a date" [required]="isQCDoneShow"
                  disabled="false">
                <mat-datepicker-toggle matSuffix [for]="qcDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #qcDatePicker disabled="false"></mat-datepicker>
                   <mat-error *ngIf="!qcDate">QC Date is required</mat-error>
              </mat-form-field>
           
            </ion-col>
          </ion-row>
          <ion-row *ngIf="isQCDoneShow && qcDone=='yes'">
            <ion-col size="12">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>QC Done By </mat-label>
                <input matInput [(ngModel)]="qcDoneBy" name="seroqcDoneBy" #seroqcDoneBy="ngModel" placeholder="" [required]="isQCDoneShow">
                <mat-error *ngIf="!qcDoneBy">QC Done By is required</mat-error>
              </mat-form-field>  
            </ion-col>
          </ion-row>

        </ion-grid>

        <mat-action-row>
          <button mat-button color="primary" (click)="prevStep()">Previous</button>
          <button mat-button color="warn" type="submit" (click)="nextStepTestPanel(shipmentPanelForm.valid,'next')">Next</button>
        </mat-action-row>
      </mat-expansion-panel>
    </form>

    <!-- <form #testKitPanelForm="ngForm" novalidate> -->
    <div *ngFor="let kitTextItem of testKitTextArray;let i = index;">
      <mat-expansion-panel [expanded]="step === i+2" (opened)="setStep(i+2)" *ngIf="testKitNameArray[kitTextItem].status==true">
        <mat-expansion-panel-header class="formMatExpPanel">
          <mat-panel-title >
            <ion-grid class="panelHeading">
              <ion-row>
                <ion-col size="12" class="grid-readonly-col">
                  <span class="text-title-color">  {{kitTextItem}}</span>
                </ion-col>
              </ion-row>
            </ion-grid>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <ion-row>
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Kit Name </mat-label>
              <mat-select [(ngModel)]="kitName[i]" name="kit">
                <mat-option>--Select--</mat-option>
                <mat-option *ngFor="let kitNameItem of testKitNameArray[kitTextItem].data" selected="selected"
                  [value]="kitNameItem.value" required>
                  {{kitNameItem.show}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Lot Number</mat-label>
              <input matInput [(ngModel)]="lot[i]" placeholder="Enter Lot Number">
            </mat-form-field>
          </ion-col>
        </ion-row>
        <ion-row>

          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Exp Date</mat-label>
              <input matInput [matDatepicker]="expDatePicker" [(ngModel)]="expDate[i]" placeholder="Choose a date"
                required disabled="false">
              <mat-datepicker-toggle matSuffix [for]="expDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #expDatePicker disabled="false"></mat-datepicker>
            </mat-form-field>
          </ion-col>
        </ion-row>
        <mat-action-row>
          <button mat-button color="primary" (click)="prevStep()">Previous</button>
          <button mat-button color="warn" (click)="nextStep()">Next</button>
        </mat-action-row>
      </mat-expansion-panel>
    </div>
    <!-- </form> -->

    <!-- sample details start -->
    <!-- <div *ngFor="let sampleTextItem of samplesTextArray;let i = index;" >

  <mat-expansion-panel [expanded]="step === i+testKitIndex+2" (opened)="setStep(i+testKitIndex+2)" >
    <mat-expansion-panel-header>
      <mat-panel-title>
       {{sampleTextItem}}
      </mat-panel-title>

    </mat-expansion-panel-header>
    <ion-row *ngFor="let resultName of resultsTextArray;let r=index">
      <ion-col size="12">
        <mat-form-field class="login-full-width grid-col-form" appearance="outline">
          <mat-label>{{resultName}}</mat-label>
          <mat-select [(ngModel)]="sampleResultObj[sampleTextItem][resultName]" name="sampleResultXerology[r]" [ngModelOptions]="{standalone: true}">
            <mat-option>--Select--</mat-option>
            <mat-option *ngFor="let item of sampleDetailsArray[sampleTextItem][resultName].data" [value]="item">
              {{item.show}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ion-col>
    </ion-row>

    <mat-action-row>
      <button mat-button color="primary" (click)="prevStep()">Previous</button>
      <button mat-button color="warn" (click)="nextStep()">Next</button>
    </mat-action-row>
  </mat-expansion-panel>
</div> -->


    <div *ngFor="let sampleTextItem of samplesTextArray ;let i = index;">

      <mat-expansion-panel [expanded]="step === i+testKitIndex+2" (opened)="setStep(i+testKitIndex+2)">
        <mat-expansion-panel-header class="formMatExpPanel">
          <mat-panel-title>
            <ion-grid class="panelHeading">
              <ion-row>
                <ion-col size="12" class="grid-readonly-col">
                  <span class="text-title-color">{{sampleTextItem}} <span class="danger-text" *ngIf="sampleDetailsArray.samples.mandatory[i]==true">*</span></span>
                </ion-col>
              </ion-row>
            </ion-grid>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngFor="let resultName of resultsTextArray;let r=index">
          <ion-row>
            <ion-col size="12" *ngIf="sampleDetailsArray[sampleTextItem][resultName].status==true">
              <mat-form-field class="login-full-width grid-col-form" appearance="outline">
                <mat-label>{{resultName}} </mat-label>
                <mat-select [(ngModel)]="sampleDetailsArray[sampleTextItem][resultName].value"
                  name="sampleDetailsArray[sampleTextItem][resultName]"
                 [required]>
                  <mat-option>--Select--</mat-option>
                  <mat-option *ngFor="let item of sampleDetailsArray[sampleTextItem][resultName].data"
                    [value]="item.value">
                    {{item.show}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ion-col>
          </ion-row>
        </div>

        <mat-action-row>
          <button mat-button color="primary" (click)="prevStep()">Previous</button>
          <button mat-button color="warn" (click)="nextStep()">Next</button>
        </mat-action-row>
      </mat-expansion-panel>
    </div>
    <!-- sample details end -->


    <form #otherInfoPanelForm="ngForm" novalidate>
    <mat-expansion-panel [expanded]="step === testKitIndex+sampleIndex+2"
      (opened)="setStep(testKitIndex+sampleIndex+2)">
      <mat-expansion-panel-header class="formMatExpPanel">
        <mat-panel-title>
          <ion-grid class="panelHeading">
            <ion-row>
              <ion-col size="10" class="grid-readonly-col">
                <span class="text-title-color">Other Informations</span>
              </ion-col>
              <ion-col size="2" class="grid-readonly-col" *ngIf="isValidOtherInfoPanel==true">
                <ion-icon name="checkmark-circle" class="checkMarkIcon"></ion-icon>
              </ion-col>
            </ion-row>
          </ion-grid>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ion-grid>
        <ion-row>
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Supervisor Review </mat-label>
              <mat-select [(ngModel)]="supReview" name="serosupReview" #serosupReview="ngModel" required>
                <mat-option *ngFor="let item of supervisorReviewArray" [value]="item.value">
                  {{item.show}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="!supReview">Supervisor Review is required</mat-error>
            </mat-form-field>
          </ion-col>
          <ion-col size="12" *ngIf="supReview=='yes'">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>{{approvalLabel}}</mat-label>
              <input matInput [(ngModel)]="supervisorName" name="serosupervisorName" #serosupervisorName="ngModel" placeholder="Enter Supervisor Name" [required]="supReview=='yes'">
              <mat-error *ngIf="!supervisorName">Supervisor Name is required</mat-error>
            </mat-form-field>     
          </ion-col>
          <ion-col size="12">
            <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Comments</mat-label>
              <textarea matInput placeholder="Enter Comments here" [(ngModel)]="comments" name="serocomments" #serocomments="ngModel"></textarea>
            </mat-form-field>
          </ion-col>
        </ion-row>


        <!-- <ion-row *ngIf="supReview=='yes'">
        <ion-col size="12">
          <mat-form-field class="login-full-width grid-col-form" appearance="outline">
              <mat-label>Supervisor Name</mat-label>
              <input matInput [(ngModel)]="supervisorName" placeholder="" >
          </mat-form-field>
        </ion-col> 
    </ion-row> -->


      </ion-grid>

      <mat-action-row>
        <button mat-button color="primary" (click)="prevStep()">Previous</button>
        <button mat-button color="warn" (click)="submitXerologyForm(shipmentPanelForm,otherInfoPanelForm)">Submit</button>
      </mat-action-row>
    </mat-expansion-panel>
    </form>
  </mat-accordion>


</ion-content>